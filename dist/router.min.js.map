{"version":3,"file":"router.min.js","sources":["../.gobble-build/03-merge/1/router.js"],"sourcesContent":["/* LodestarJS Router - 1.0.3. \nAuthor: Dan J Ford \nContributors:  \nPublished: Mon Dec 21 2015 16:46:47 GMT+0000 (GMT)  */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Router = factory();\n}(this, function () { 'use strict';\n\n  var hasConsole = typeof console !== 'undefined';\n  var hasCollapsedConsole = !!console.groupCollapsed;\n  var hasHistory = !!(window.history && history.pushState);\n  var hasEventListener = !!window.addEventListener;\n\n  function fullExtend(dest, objs, deep) {\n    for (var i = 0, ii = objs.length; i < ii; i++) {\n      var obj = objs[i];\n\n      if (!isObject(obj)) return;\n\n      var objKeys = Object.keys(obj);\n\n      for (var j = 0, jj = objKeys.length; j < jj; j++) {\n        var key = objKeys[j];\n        var val = obj[key];\n\n        if (isObject(val) && deep) {\n          if (!isObject(dest[key])) dest[key] = Array.isArray(val) ? [] : {};\n          fullExtend(dest[key], [val], true);\n        } else {\n          dest[key] = val;\n        }\n      }\n    }\n\n    return dest;\n  }\n\n  /**\n   * Low extend of the object i.e. not recursive copy\n   *\n   * @param  {Object} dest, the object that will have properties copied to it\n   * @param  {Object} val, the second object with the properties to copy\n   * @return {Object} the new object with properties copied to it\n   */\n  function merge(dest, val) {\n    return fullExtend(dest, [val], false);\n  }\n\n  /**\n   * Deep extend the object i.e. recursive copy\n   *\n   * @param  {Object} dest, the object that will have properties copied to it\n   * @param  {Object} val, the second object with the properties to copy\n   * @return {Object} the new object with properties copied to it\n   */\n  function copy(dest, val) {\n    return fullExtend(dest, [val], true);\n  }\n\n  /**\n   * @param  {Object} val, the parameter to check if it is a object\n   * @return {Boolean} whether or not the parameter is an object\n   */\n  function isObject(val) {\n    return val !== null && typeof val === 'object';\n  }\n\n  var globals = {\n    DEBUG: true\n  };\n  var defaultConfig = {\n    useHistory: false,\n    basePath: '',\n    loggingLevel: 'LOW', // options are LOW or HIGH\n    usingMap: '',\n    listenerActive: false\n  };\n  /**\n   * This initialises the config for each instance with a fresh config,\n   * also adds a global variable to the window which may be used by other libs.\n   *\n   * @param  {Object} _this, this passed in from the constructore\n   * @return {Void}, nothing returned\n   */\n  function initConfig(_this) {\n\n    _this.routes = {};\n    _this.config = merge({}, defaultConfig);\n    window.LodeVar = window.LodeVar || {};\n  }\n\n  /**\n   * Modifies the config for an instance\n   * @param  {Object} _this, this passed in from the constructore\n   * @param  {Object} changes, the changes the user wants to make to the config.\n   * @return {Void}, nothing returned\n   */\n  function modifyConfig(_this, changes) {\n\n    if (changes) {\n\n      if (typeof changes.DEBUG !== 'undefined') globals = copy({}, { DEBUG: changes.DEBUG });delete changes.DEBUG;\n\n      if (changes.loggingLevel) changes.loggingLevel = changes.loggingLevel.toUpperCase();\n\n      _this.config = fullExtend({}, [_this.config, changes], true);\n    }\n\n    return _this.config;\n  }\n\n  var logger = {};\n\n  logger.debug = function () {\n    if (hasConsole && globals.DEBUG) console.debug.apply(console, arguments);\n  };\n\n  logger.log = function () {\n    if (hasConsole && globals.DEBUG) console.log.apply(console, arguments);\n  };\n\n  logger.warn = function () {\n    if (hasConsole && globals.DEBUG) console.warn.apply(console, arguments);\n  };\n\n  var routerIntro = ['LodestarJs-Router 1.0.3 in debug mode.'];\n  var routerMessage = '\\n\\nHello, you are running the LodestarJs Router 1.0.3 in debug mode.\\nThis will help you to identify any problems in your application.\\n\\nDEBUG mode is a global option, to disable debug mode will disable it for each\\ninstance. You can disable it when declaring a new instance. For example,\\nnew Router({DEBUG: false});\\n\\nFor documentation head to the wiki:\\n  https://github.com/lodestarjs/lodestar-router/wiki\\n\\nIf you have found any bugs, create an issue for us:\\n  https://github.com/lodestarjs/lodestar-router/issues\\n\\n';\n\n  /**\n   * The welcome function gives a message to the user letting the know\n   * some key things about the Router.\n   * @return {Void}, nothing returned\n   */\n  function welcome() {\n\n    if (hasConsole && globals.DEBUG) {\n\n      console[hasCollapsedConsole ? 'groupCollapsed' : 'log'].apply(console, routerIntro);\n\n      console.log(routerMessage);\n\n      if (hasCollapsedConsole) {\n        console.groupEnd(routerIntro);\n      }\n    }\n  }\n\n  /**\n   * Logs the route that has not been found.\n   * @param  {String} path, the child of the parent route to watch.\n   * @param  {String} originalPath, the original path\n   * @return {Void}, nothing returned\n   */\n  function notFoundLog(path, originalPath) {\n    logger.warn('Route ' + path + ' of ' + originalPath + ' not found.');\n  }\n\n  /**\n   * Clears the routes cache of no longer needed active routes\n   * @param  {String} key, the original to not remove active from\n   * @param  {Object} pointer, the pointer to clear the cache from\n   * @return {Void}, nothing returned\n   */\n  function clearCache(key, pointer) {\n\n    var props = Object.getOwnPropertyNames(pointer);\n\n    for (var i = 0, ii = props.length; i < ii; i++) {\n\n      if (props[i] !== key) {\n\n        pointer[props[i]].active = false;\n\n        if (pointer[props[i]].childRoutes) {\n\n          clearCache(false, pointer[props[i]].childRoutes);\n        }\n      }\n    }\n  }\n\n  /**\n   * Splits the dynamic part\n   * @param  {String} path, the current path to match the dynamic section\n   * @param  {Array} splitKey, the path split into dynamic segments\n   * @return {Object}, the object to map the dynamic segments into\n   */\n  function dynamicSplit(path, splitKey) {\n\n    var output = {};\n\n    splitKey.shift();\n\n    for (var i = 0, ii = splitKey.length; i < ii; i++) {\n\n      output[splitKey[i].replace(/\\//g, '')] = path.match(/[^\\/]*/g)[i !== 0 ? i + i : i];\n    }\n\n    return output;\n  }\n\n  /**\n   * The page not found function, will execute a not found function that the user sets up\n   * @param  {String} path, the current path that was not found\n   * @param  {String} originalPath, the parent of the current path that was not found\n   * @return {Void}, nothing returned\n   */\n  function pageNotFound(path, originalPath) {\n\n    if (typeof this.userNotFound !== 'undefined') this.userNotFound();\n\n    notFoundLog(path, originalPath);\n  }\n\n  function getParentController(pointer) {\n\n    return pointer.controller;\n  }\n\n  /**\n   * This goes through the entire routing tree, executing the matching paths.\n   *\n   * It also makes use of caching as in that it will only need to execute the\n   * paths that are necessary.\n   *\n   * @param  {String} path, the current path that we are on\n   * @return {Void}, nothing returned\n   */\n  function resolve(path) {\n    var _this = this;\n\n    if (path === '') path = '/';\n    if (!path) return;\n\n    var pointer = this.routes,\n        parent = false,\n        originalPath = path,\n        isFinal = false,\n        keyCache = '',\n        matchedParent = false;\n\n    while (path.length) {\n\n      var routeData = {};\n\n      // For each child of the current pointer which is some child of routes\n\n      var _loop = function (_key) {\n\n        var dynamicKey = false;\n\n        keyCache = _key;\n\n        // If contains : then it has dynamic segments\n        if (_key.indexOf(':') > -1) {\n\n          var splitKey = _key.split(':');\n\n          // If there are more : than expected then there are multiple dynamic segments\n          if (splitKey.length > 2) {\n\n            routeData = dynamicSplit(path, splitKey);\n            dynamicKey = _key.replace(/\\:[^\\/]*/g, '[^\\\\/]*');\n          } else {\n\n            routeData[_key.replace(':', '')] = path.match(/[^\\/]*/)[0];\n            dynamicKey = /[^\\/]*/;\n          }\n        }\n\n        // If contains * then there is a wildcard segment\n        if (_key.match(/\\*[a-z]+/i)) {\n\n          routeData[_key.replace(/\\*[a-z]+/i, '')] = path.match(/.*/)[0].split('/');\n          dynamicKey = /.*/;\n        }\n\n        matchedParent = path.match('^' + (dynamicKey || _key));\n\n        // Find out if we're on the final run\n        isFinal = matchedParent && path.replace(matchedParent[0], '').replace(/^\\//, '').replace(/\\/$/, '').length === 0 ? true : false;\n\n        if (path.length && matchedParent) {\n\n          // If it's not the final run and the current route is not active, execute it\n          if (!pointer[_key].active && !isFinal) {\n\n            pointer[_key].routeData = routeData;\n            pointer[_key].active = true;\n            pointer[_key].getParent = parent ? getParentController(parent) : function () {\n              throw new Error('No parent found for ' + _key);\n            };\n            pointer[_key].controller();\n          }\n\n          // Remove current part from the path\n          path = path.replace(matchedParent[0], '').replace(/^\\//, '').replace(/\\/$/, '');\n\n          // Remove active from siblings and their children\n          if (pointer[_key]) clearCache(_key, pointer);\n\n          // If it is not final then re-assign the pointer\n          if (pointer[_key].childRoutes && !isFinal) {\n\n            parent = pointer[_key];\n            pointer = pointer[_key].childRoutes;\n          } else if (!isFinal) {\n\n            pageNotFound.call(_this, path, originalPath);\n            path = '';\n          }\n\n          return 'break';\n        }\n      };\n\n      for (var _key in pointer) {\n        var _ret = _loop(_key);\n\n        if (_ret === 'break') break;\n      }\n\n      // If it's the final page, re-execute it and set to active\n      if (isFinal) {\n\n        pointer[keyCache].routeData = routeData;\n        pointer[keyCache].active = true;\n        if (parent) pointer[key].getParent = getParentController(parent);\n        pointer[keyCache].controller();\n      } else if (!matchedParent) {\n\n        pageNotFound.call(this, path, originalPath);\n        path = '';\n        break;\n      }\n    }\n  }\n\n  /**\n   * Used in createRoute to map a routing object to a parent in a way\n   * that the Router can understand it.\n   * @param  {String} parents, the parent path\n   * @param  {Object} routeObject, the object to add as a child\n   * @return {Void}, nothing returned\n   */\n  function traverse(parents, routeObject) {\n\n    var pointer = this.routes,\n        createPointer = {};\n\n    while (parents.length) {\n\n      for (var _key2 in pointer) {\n\n        var matchedParent = parents.match('^' + _key2);\n\n        if (parents.length && matchedParent) {\n\n          parents = parents.replace(matchedParent[0], '').replace(/^\\//, '').replace(/\\/$/, '');\n\n          createPointer = pointer[_key2];\n          pointer = pointer[_key2].childRoutes || pointer[_key2];\n\n          break;\n        }\n      }\n    }\n\n    if (typeof createPointer.childRoutes === 'undefined') {\n      createPointer.childRoutes = {};\n    }\n\n    routeObject.path = routeObject.path.substring(routeObject.path.indexOf(']') + 1).replace(/^\\//, '').replace(/\\/$/, '');\n\n    createPointer.childRoutes[routeObject.path] = {};\n    createPointer.childRoutes[routeObject.path].controller = routeObject.controller;\n  }\n\n  /**\n   * Returns all of the current routes in this instance of the Router.\n   * @return {Object} returns the routes.\n   */\n  function getRoutes() {\n\n    return copy({}, this.routes);\n  }\n\n  function formatRoute(route) {\n\n    if (route === '') {\n      route = '/';\n    }\n\n    route = route.replace(/^(\\/?[\\#\\!\\?]+)/, '').replace(/$\\//, '');\n\n    if (this.config.basePath.length) {\n      route = route.replace(this.config.basePath, '');\n    }\n\n    return route;\n  }\n\n  /**\n   * For createRoute() grab the parent specified in the []\n   * @param  {String} url, the route to find a parent in\n   * @return {String}, the parent URL\n   */\n  function getParent(url) {\n    var begin = url.indexOf('[') + 1,\n        end = url.indexOf(']');\n    return url.substring(begin, end);\n  }\n\n  /**\n   * Removes the origin from the link, for those who are using absolute links..\n   * @param  {String} link, the link to have the origin removed from it.\n   * @return {String}, the link with the origin removed.\n   */\n  function removeOrigin(link) {\n\n    if (!window.location.origin) {\n      return link.replace(window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : ''), '');\n    } else {\n      return link.replace(window.location.origin, '');\n    }\n  }\n\n  /**\n   * Traverses through the parent nodes to look for an Anchor tag.\n   * Used in historyMode.\n   * @param  {HTMLElement} target, the element to begin traversing from.\n   * @return {Boolean|HTMLElement} returns false or the found element.\n   */\n  function checkParents(target) {\n\n    while (target) {\n\n      if (target instanceof HTMLAnchorElement) {\n        return target;\n      }\n\n      target = target.parentNode;\n    }\n\n    return false;\n  }\n\n  /**\n   * On click, finds the anchor tag formats the link and returns it.\n   * @param  {Event} e, the event passed through from the click event.\n   * @return {String} returns the formatted href for this link\n   */\n  function historyClick(e) {\n\n    e = window.e || e;\n\n    var target = e.target,\n        anchorLink = '',\n        targetAttr = '',\n        formattedRoute = '',\n        unformattedRoute = '';\n\n    if (target.tagName !== 'A') target = checkParents(target);\n\n    if (!target) return;\n\n    anchorLink = target.getAttribute('href');\n    targetAttr = target.getAttribute('target');\n\n    if (anchorLink.indexOf(':') > -1 && !anchorLink.match(/(?:https?):/)) return;\n\n    if (targetAttr === '_blank' || anchorLink.match(/(?:https?):/) && anchorLink.indexOf(window.location.hostname) === -1) return;\n\n    // To push to the url in case there is a base path\n    unformattedRoute = removeOrigin(anchorLink);\n    formattedRoute = formatRoute.call(this, unformattedRoute);\n\n    history.pushState(null, null, unformattedRoute);\n\n    e.preventDefault();\n\n    return formattedRoute === '' ? '/' : formattedRoute;\n  }\n\n  /**\n   * This sets up the events for 'Hashchange' and 'History' mode depending on what has been selected and what is available.\n   * @return {Void}, nothing returned\n   */\n  function listener() {\n    var _this = this;\n\n    if (this.config.listenerActive) return;\n\n    if (this.config.loggingLevel === 'HIGH') logger.debug('Listener is now active.');\n\n    var windowListener = hasEventListener ? window.addEventListener : window.attachEvent,\n        docListener = hasEventListener ? document.addEventListener : document.attachEvent,\n        initialLink = this.config.useHistory && hasHistory ? window.location.pathname : window.location.hash;\n\n    this.config.listenerActive = true;\n\n    docListener('click', function (e) {\n      window.LodeVar.previousPath = formatRoute.call(_this, removeOrigin(window.location.href));\n    });\n\n    if (!this.config.useHistory || !hasHistory) {\n\n      if (this.config.loggingLevel === 'HIGH') logger.debug('Listening for hash changes.');\n\n      windowListener(hasEventListener ? 'hashchange' : 'onhashchange', function () {\n        _this.resolve(formatRoute.call(_this, window.location.hash));\n      });\n    } else if (this.config.useHistory && hasHistory) {\n\n      if (this.config.loggingLevel === 'HIGH') logger.debug('Listening for clicks or popstate.');\n\n      docListener('click', function (e) {\n\n        var historyLink = historyClick.call(_this, e);\n\n        if (historyLink) {\n          _this.resolve(historyLink);\n        }\n      });\n      windowListener('popstate', function () {\n        _this.resolve(formatRoute.call(_this, window.location.pathname));\n      });\n    }\n\n    // Fire the initial page load link\n    this.resolve(formatRoute.call(this, initialLink));\n  }\n\n  /**\n   * The bare bones-way of creating a routing object\n   * @param  {Object} routeObject, the route object as the Router expects it\n   * @return {Void}, nothing returned\n   */\n  function map(routeObject) {\n\n    if (this.config.usingMap === false) throw new Error('Do not use map() as well as createRoute().');\n\n    for (var key in routeObject) {\n\n      this.routes[key] = routeObject[key];\n    }\n\n    this.config.usingMap = true;\n\n    listener.call(this);\n  }\n\n  /**\n   * The nicer way of creating a route filled with validation, may take longer than map().\n   * @param  {Object} routeObject, an object that the Router will translate into an object it can understand\n   * @return {Void}, nothing returned\n   */\n  function createRoute(routeObject) {\n    var _this = this;\n\n    if (this.config.usingMap === true) throw new Error('Do not use createRoute() as well as map().');\n\n    if (!routeObject) throw new Error('No route object defined.');\n\n    if (!routeObject.path) throw new Error('Please define the route to use.');\n\n    if (!routeObject.controller || typeof routeObject.controller !== 'function') throw new Error('Please define the function that should be executed.');\n\n    var parentUrls = '';\n\n    if (routeObject.path.indexOf('[') > -1) {\n\n      parentUrls = getParent(routeObject.path);\n\n      traverse.call(this, parentUrls, routeObject);\n    } else {\n\n      routeObject.path = formatRoute.call(this, routeObject.path);\n      this.routes[routeObject.path] = {};\n      this.routes[routeObject.path].controller = routeObject.controller;\n    }\n\n    if (this.config.usingMap === '') {\n\n      setTimeout(function () {\n        listener.call(_this);\n      }, 0);\n    }\n\n    this.config.usingMap = false;\n  }\n\n  function Router(options) {\n\n    initConfig(this);\n\n    modifyConfig(this, options);\n\n    welcome();\n  }\n\n  Router.prototype = {\n\n    createRoute: createRoute,\n    map: map,\n    getRoutes: getRoutes,\n    resolve: resolve,\n    notFound: function notFound(callback) {\n      this.userNotFound = callback;\n    }\n\n  };\n\n  return Router;\n\n}));"],"names":["global","factory","exports","module","define","amd","Router","this","fullExtend","dest","objs","deep","i","ii","length","obj","isObject","objKeys","Object","keys","j","jj","key","val","Array","isArray","merge","copy","initConfig","_this","routes","config","defaultConfig","window","LodeVar","modifyConfig","changes","DEBUG","globals","loggingLevel","toUpperCase","welcome","hasConsole","console","hasCollapsedConsole","apply","routerIntro","log","routerMessage","groupEnd","notFoundLog","path","originalPath","logger","warn","clearCache","pointer","props","getOwnPropertyNames","active","childRoutes","dynamicSplit","splitKey","output","shift","replace","match","pageNotFound","userNotFound","getParentController","controller","resolve","parent","isFinal","keyCache","matchedParent","routeData","_loop","_key","dynamicKey","indexOf","split","getParent","Error","call","_ret","traverse","parents","routeObject","createPointer","_key2","substring","getRoutes","formatRoute","route","basePath","url","begin","end","removeOrigin","link","location","origin","protocol","hostname","port","checkParents","target","HTMLAnchorElement","parentNode","historyClick","e","anchorLink","targetAttr","formattedRoute","unformattedRoute","tagName","getAttribute","history","pushState","preventDefault","listener","listenerActive","debug","windowListener","hasEventListener","addEventListener","attachEvent","docListener","document","initialLink","useHistory","hasHistory","pathname","hash","previousPath","href","historyLink","map","usingMap","createRoute","parentUrls","setTimeout","options","groupCollapsed","arguments","prototype","notFound","callback"],"mappings":"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"}